# 簡易カラオケ字幕スクリプト for AviUtl ExEdit2
AviUtl ExEdit2（通称 AviUtl2）で使える簡易カラオケ字幕スクリプトです。  
微熱様 ([@binetsu0904](https://twitter.com/binetsu0904)) による AviUtl 用[簡易カラオケ字幕スクリプト](https://www.dropbox.com/scl/fi/byrfxdzcqy37ukeazlvln/aviutl_karaoke_text_script_201101.zip?rlkey=zydz7hghowsuntlfi64ulzkr4&e=1&dl=0)に似せて作りました。


## 概要
* ルビ付きのテキストを作成することができます。
* カラオケ字幕のようにテキストの色を時間変化させることができます。
* 1文字ごとに変化速度を変えることができます。
* MAD 作者向けのジョーク機能として、嘘字幕機能があります。  
  変化前と変化後に別々のテキストを用意し、カラオケ字幕のように変化させることができます。


## 動作環境
* 以下のバージョンの AviUtl2 で動作確認済です。
	* AviUtl ExEdit2 version 2.0beta18a


## 微熱様のオリジナル版との差異
* AviUtl ExEdit2 (AviUtl2) で動作します。AviUtl (AviUtl1) では動作しません。
* アニメーション効果ではなくカスタムオブジェクトとして動作します。
* 特殊記号 `[` `]` 等をエスケープできるようにしました。（[入力上の注意事項](#入力上の注意事項)を参照）
* 特殊記号 `/` でルビを区切ることで文字毎に割り付けられる機能を削除しました。
	* ルビを文字毎に割り付けたいときは `[堕天使]` `[だ/てん/し]` ではなく `[堕][天][使]` `[だ][てん][し]` のように入力してください。
* 特殊記号 `_` を挟むことで複数文字（複数コードポイント）を1文字として扱う機能を追加しました。
* 字幕の配置を、基準座標を中心とする中央揃えだけでなく、上下や左右に寄せることができるようにしました。
* ルビの配置を、メインテキストに対する中央揃えだけでなく、左寄せ/右寄せ/均等割り付けにできるようにしました。
* ルビがメインテキストからはみ出すときに切れてしまう場合があったのを改善しました。


## 導入方法
* `簡易カラオケ字幕.obj2` をお使いの AviUtl2 の `Script` フォルダに入れてください。


## 使い方
### 基本的な使い方
* AviUtl2 の [オブジェクトを追加] - [カスタムオブジェクト] から [簡易カラオケ字幕] を追加してください。
* 表示したいテキストをオブジェクト設定パネルの [字幕] 欄に入力してください。  
  ルビを付したいときは、 [字幕] 欄のテキストのうちルビを付したい部分を角括弧 `[` `]` で括り、対応するルビを [ルビ] 欄に角括弧 `[` `]` で括って入力します。  
  例えば以下のように入力すると、**ここに<ruby>歌<rt>か</rt></ruby><ruby>詞<rt>し</rt></ruby>を<ruby>入<rt>にゅう</rt></ruby><ruby>力<rt>りょく</rt></ruby>します** と表示されます。
	* [字幕] 欄: `ここに[歌][詞]を[入][力]します`
	* [ルビ] 欄: `[か][し][にゅう][りょく]`
* [字幕] 欄で角括弧 `[` `]` に代えて波括弧 `{` `}` を用いることで、メインテキストに対するルビの付き方を変えることができます。
	* `[文字列]` : 中央揃え
	* `{文字列]` : 左寄せ
	* `[文字列}` : 右寄せ
	* `{文字列}` : 均等割り付け
* テキストの色の変化は [変化度] 欄の値（`0.0` ～ `100.0`）で制御します。  
  特に拘りが無ければ、 [変化度] をクリックして `直線移動` を選択し、左欄に `0.0`、右欄に `100.0` と入力すれば良いでしょう。
* 文字毎の色の変化速度（[変化度] との対応付け）は、[変化時間比率] 欄で指定できます。  
  各文字の色変化にかけたい時間を数字 `0` ～ `9` で指定して並べてください。  
  例えば以下のように入力すると、歌詞 **あいうえお** のうち文字 **う** の色変化に要する時間が他の文字の3倍となります。
	* [字幕] 欄: `あいうえお`
	* [変化時間比率] 欄: `11311`


### 嘘字幕の使い方
* [字幕] [ルビ] 欄と同じ要領で [嘘字幕] [嘘ルビ] 欄に字幕とそのルビを入力してください。  
  初期表示時点では [字幕] [ルビ] 欄の字幕が、色変化後は [嘘字幕] [嘘ルビ] 欄の字幕が表示されます。


### 入力上の注意事項
* [字幕] [ルビ] 欄に記号 **[** **]** **{** **}** **_** **%** を含めたいときは、それぞれ `%[` `%]` `%{` `%}` `%_` `%%` と入力してください。
* [字幕] [ルビ] 欄に記号 **"** **\\** を含めたいときは、それぞれ `\"` `\\` と入力してください。
* 特殊記号 `_` は、その前後の文字（コードポイント）を合わせて1文字として扱うようにする記号です。  
  字間機能や均等割り付けにおいて間を空けたくない文字の間に挿入してください。
	* 例えば字上符の付いた文字 **p̚** (U+0070 U+031A) を使うときは `p_̚` のように入力すると良いでしょう。
	* 変わった使い方としては、`<s>` のような AviUtl2 の制御文字列を適用させたいときは、`<_s_>_` のように入力すれば適用可能です。
	* 本当は複数コードポイントからなるリガチャや絵文字に使えると良かったのですが、残念乍らそういったものは抑〻 AviUtl2 が対応していないようです。
* [変化時間比率] 欄で 10 以上の値を指定したいときは、ASCII コードが `9` に後続する文字 `:` (10), `;` (11), `<` (12), `=` (13), `>` (14), … を入力してください。

## 設定項目一覧
|設定項目          |設定可能な値      |既定値     |説明|
|---               |---               |---        |--- |
|**字幕**          |文字列            |ここに[歌][詞]を[入][力]します|色変化前の字幕メインテキスト|
|**ルビ**          |文字列            |[か][し][にゅう][りょく]|色変化前の字幕ルビ|
|**変化時間比率**  |数字列            |11111122111|各文字に割り当てる変化度の比率|
|**嘘字幕**        |文字列            |           |色変化後の字幕メインテキスト<br />（省略時は**字幕**と同じ値を使用）|
|**嘘ルビ**        |文字列            |           |色変化後の字幕ルビ<br />（省略時は**ルビ**と同じ値を使用）|
|**ルビ倍率**      |0 – 100           |40         |メインテキストに対するルビのフォントサイズの比率|
|**ルビ位置X**     |-1000.00 – 1000.00|0.00       |指定した長さだけルビを標準の位置から右方向にずらす|
|**ルビ位置Y**     |-1000.00 – 1000.00|0.00       |指定した長さだけルビを標準の位置から下方向にずらす|
|**変化度**        |0.0 – 100.0       |30.0       |字幕全体のうち色変化させる部分の割合 (%)|
|**変化前文字色**  |色                |#FFFFFF    |色変化前の字幕の文字の色|
|**変化前輪郭色**  |色                |#000000    |色変化前の字幕の影/縁の色|
|**変化後文字色**  |色                |#0000FF    |色変化後の字幕の文字の色|
|**変化後輪郭色**  |色                |#FFFFFF    |色変化後の字幕の影/縁の色|
|**配置**          |左寄せ[上]<br />中央揃え[上]<br />右寄せ[上]<br />左寄せ[中]<br />中央揃え[中]<br />右寄せ[中]<br />左寄せ[下]<br />中央揃え[下]<br />右寄せ[下]|中央揃え[中]|基準座標に対する字幕の配置|
|**嘘字幕配置**    |左寄せ<br />中央揃え<br />右寄せ|左寄せ|色変化前後の字幕の相対位置|
|**フォント**      |フォント名        |Meiryo UI  |字幕のフォント|
|**フォントサイズ**|1 – 400           |120        |字幕のフォントサイズ|
|**太字**          |真偽値            |true       |字幕のフォントを太字にする|
|**斜体**          |真偽値            |false      |字幕のフォントを斜体にする|
|**文字修飾**      |標準文字<br />影付き文字<br />影付き文字（薄）<br />縁取り文字<br />縁取り文字（細）<br />縁取り文字（太）<br />縁取り文字（角）|縁取り文字|字幕の文字修飾|
|**字間機能を使う**|真偽値            |false      |字間機能を有効化する|
|**字間**          |-100 – 100        |0          |字間機能が有効であるとき、指定した長さだけ字幕の各文字の間を空ける|
|**ガイドを表示**  |真偽値            |true       |字幕の各文字の下に変化時間比率の値を表示する<br />（ガイドは動画へは出力されません）|


## 改訂履歴
* 2025年11月03日
	* 初版公開
* 2025年11月05日
	* 左寄せ/右寄せを指定したときに仮想バッファを2倍確保していたのを修正
	* ルビの高さの計算に誤りがあったのを修正
	* 文字の高さが一定でないフォントで字間機能を有効化したときに文字の上下位置がズレる問題を修正
	* 上下方向の配置（上寄せ/下寄せ）を指定できるよう改善
	* 嘘字幕の相対位置（左寄せ/中央揃え/右寄せ）を指定できるよう改善
* 2025年11月06日
	* 仮想バッファの高さの計算に誤りがあったのを修正
* 2025年11月08日
	* ルビの左寄せ/右寄せ/均等割り付け機能を追加
	* 入力文字列の解析に失敗した場合に「エラー」と出力するよう修正
* 2025年11月09日
	* [ルビ位置X] が正しく機能していなかったのを修正

