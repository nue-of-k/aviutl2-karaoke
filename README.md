# 簡易カラオケ字幕スクリプト for AviUtl ExEdit2
AviUtl ExEdit2（通称 AviUtl2）で使える簡易カラオケ字幕スクリプトです。  
微熱様 ([@binetsu0904](https://twitter.com/binetsu0904)) による AviUtl 用[簡易カラオケ字幕スクリプト](https://www.dropbox.com/scl/fi/byrfxdzcqy37ukeazlvln/aviutl_karaoke_text_script_201101.zip?rlkey=zydz7hghowsuntlfi64ulzkr4&e=1&dl=0)に似せて作りました。


## 概要
* ルビ付きのテキストを作成することができます。
* カラオケ字幕のようにテキストの色を時間変化させることができます。
* 1文字ごとに変化速度を変えることができます
* MAD 作者向けのジョーク機能として、嘘字幕機能があります。  
  変化前と変化後に別々のテキストを用意し、カラオケ字幕のように変化させることができます。


## 微熱様のオリジナル版との差異
* AviUtl ExEdit2 (AviUtl2) で動作します。AviUtl (AviUtl1) では動作しません。
* アニメーション効果ではなくカスタムオブジェクトとして動作します。
* 記号 `[` `]` をエスケープできるようにしました。
	* 字幕に文字 **[** や **]** を含めたいときはそれぞれ `%[` `%]` と入力してください。
	* 字幕に文字 **%** を含めたいときは `%%` と入力してください。
	* 字幕に文字 **"** や **\\** を含めたいときはそれぞれ `\"` `\\` と入力してください。（これはオリジナル版と同じ）
* 記号 `/` でルビを区切ることで文字毎に割り付けられる機能を削除しました。
	* ルビを文字毎に割り付けたいときは `[堕天使]` `[だ/てん/し]` ではなく `[堕][天][使]` `[だ][てん][し]` のように入力してください。
* 記号 `_` を挟むことで複数文字（複数コードポイント）を1文字として扱う機能を追加しました。
	* 例えば字上符の付いた文字 **p̚** を使うときは `p_̚` のように入力すると良いでしょう。
	* 本当は複数コードポイントからなるリガチャや絵文字に使えると良かったのですが、そういったものは抑〻 AviUtl2 が対応していないので、あまり使いどころは無いかもしれません。
	* 変わった使い方としては、`<s>` のような AviUtl2 の制御文字列を `<_s_>_` のように入力することで適用させることができます。
* 中央揃えだけでなく、基準座標に対して字幕を上下左右に寄せることができるようにしました。
* ルビがメインテキストからはみ出すときに切れてしまう場合があったのを改善しました。


## 導入方法
* `簡易カラオケ字幕.obj2` をお使いの AviUtl2 の `Script` フォルダに入れてください。


## 使い方
* AviUtl2 の `オブジェクトを追加` - `カスタムオブジェクト` から `簡易カラオケ字幕` を追加してください。
* 表示したいテキストをオブジェクト設定パネルの「字幕」欄に入力してください。  
  ルビを付したいときは、「字幕」欄のテキストのうちルビを付したい部分を角括弧 `[` ～ `]` で括り、対応するルビを「ルビ」欄に角括弧 `[` ～ `]` で括って入力します。  
  例えば以下のように入力すると、**ここに<ruby>歌<rt>か</rt></ruby><ruby>詞<rt>し</rt></ruby>を<ruby>入<rt>にゅう</rt></ruby><ruby>力<rt>りょく</rt></ruby>します** と表示されます。
	* 「字幕」欄: `ここに[歌][詞]を[入][力]します`
	* 「ルビ」欄: `[か][し][にゅう][りょく]`
* テキストの色の変化は「変化度」欄の値（`0.0` ～ `100.0`）で制御します。  
  特に拘りが無ければ、「変化度」をクリックして `直線移動` を選択し、左欄に `0.0`、右欄に `100.0` と入力すれば良いでしょう。
* 文字毎の色の変化速度（「変化度」との対応付け）は、「変化時間比率」欄で指定できます。  
  各文字の色変化にかけたい時間を数字 `0` ～ `9` で指定して並べてください。  
  例えば以下のように入力すると、歌詞 **あいうえお** のうち文字 **う** の色変化に要する時間が他の文字の3倍となります。
	* 「字幕」欄: `あいうえお`
	* 「変化時間比率」欄: `11311`
		* 10 以上の値を指定したい場合は、ASCII コードが `9` に後続する文字 `:` (10), `;` (11), `<` (12), `=` (13), `>` (14), … を入力してください。


### 嘘字幕の使い方
* 「字幕」「ルビ」欄と同じ要領で「嘘字幕」「嘘ルビ」欄に字幕とそのルビを入力してください。  
  初期表示時点では「字幕」「ルビ」欄の字幕が、色変化後は「嘘字幕」「嘘ルビ」欄の字幕が表示されます。


## 改訂履歴
* 2025年11月03日 - 初版公開
* 2025年11月05日
	* 左寄せ/右寄せを指定したときに仮想バッファを2倍確保していたのを修正
	* ルビの高さの計算に誤りがあったのを修正
	* 文字の高さが一定でないフォントで字間機能を有効化したときに文字の上下位置がズレる問題を修正
	* 上下方向の配置（上寄せ/下寄せ）を指定できるよう改善
	* 嘘字幕の相対位置（左寄せ/中央揃え/右寄せ）を指定できるよう改善

